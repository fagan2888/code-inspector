(ns TVPackages.utils
  "Globally useful utility functions.

  Author: Matthias Diehn Ingesman"
  (:require [clj-htmlunit.core :as hu]))

(defn client
  "Create a new HtmlUnit web client instance."
  []
  (letfn [(block-google [client]
            (hu/block-match client "apis.google.com"))
          (block-thrane [client]
            (hu/block-match client "thrane.js"))]
    (let [c (hu/make-client :FF3.6)]
      (do
        (block-google c)
        (block-thrane c) ;; Due to method AddColorStop!
        c))))

(defn page-from
  "[url] Fetch page from url using a fresh client instance.
  [client url] Fetch page from url using client."
  ([url]
     (hu/get-page (client) url))
  ([client url]
     (hu/get-page client url)))

(defn successive-coll
  "Creates a lazy seq consisting of the elements of c in successively
  larger chunks. Example: [[1] [2] [3]] => [[1] [1 2] [1 2 3]]"
  [c]
  (reductions concat c))

(def names->APInames
  "A relation mapping channel names as seen on the various cable
  provider homepages to the names used in the API."
  {"DR1" "DR1"
   "DR2" "DR2"
   "DR HD" "DR HD"
   "DR K" "DR K"
   "DR Ramasjang" "DR Ramasjang"
   "DR Update" "DR Update"
   "TV 2" "TV 2"
   "TV 2 | Østjylland" "TV 2"
   "TV 2 Zulu" "TV 2 zulu"
   "TV2 Zulu" "TV 2 zulu"
   "TV 2 Charlie" "TV 2 charlie"
   "TV2 Charlie" "TV 2 charlie"
   "TV 2 Film" "TV 2 film"
   "TV 2 Film HD" "TV 2 film"
   "TV2 Film" "TV 2 film"
   "TV 2 FILM" "TV 2 film"
   "TV 2 News" "TV 2 NEWS"
   "TV2 News" "TV 2 NEWS"
   "TV 2 NEWS" "TV 2 NEWS"
   "TV 2 Sport" "TV 2 Sport"
   "TV 2 Sport HD" "TV 2 Sport HD"
   "TV 2 Sport (HD)" "TV 2 Sport HD"
   "TV 2 SPORT (HD)" "TV 2 Sport HD"
   "TV 3" "TV 3"
   "TV3" "TV 3"
   "TV3+" "TV3+"
   "TV3+ HD" "TV3+"
   "TV3+ (HD)" "TV3+"
   "TV 3 Puls" "TV 3 Puls"
   "TV3 Puls" "TV 3 Puls"
   "TV3 PULS" "TV 3 Puls"
   "Kanal 4" "Kanal 4"
   "Kanal 5" "Kanal 5"
   "Kanal 5 (HD)" "Kanal 5"
   "6'eren" "6´eren"
   "6'eren HD" "6´eren"
   "6'eren (HD)" "6´eren"
   "Canal9" "Canal9"
   "CANAL9" "Canal9"
   "DK4" "DK4"
   "dk4" "DK4"
   "Kanal København" "Kanal København"
   "Discovery Channel" "Discovery Channel"
   "Discovery channel" "Discovery Channel"
   "Discovery Civilisation" "Discovery Civilisation"
   "Discovery HD" "Discovery HD"
   "Discovery Science" "Discovery Science"
   "Discovery Travel & Living" "Discovery Travel & Living"
   "Travel Channel" "Discovery Travel & Living"
   "Animal HD" "Animal HD"
   "Animal Planet" "Animal Planet"
   "National Geographics" "National Geographics"
   "National Geographic" "National Geographics"
   "National Geographic Channel" "National Geographics"
   "National Geographic HD" "National Geographic HD"
   "National Geographic Wild" "National Geographic Wild"
   "History Channel" "History Channel"
   "MTV" "MTV"
   "MTV Dance" "MTV Dance"
   "MTV HD" "MTV HD"
   "MTV Hits" "MTV Hits"
   "MTV R" "MTV R"
   "MTV TWO" "MTV TWO"
   "MTV Two" "MTV TWO"
   "MTV 2" "MTV TWO"
   "VH1" "VH1"
   "Vh1" "VH1"
   "VH1 Danmark" "VH1"
   "VH1 Classic" "VH1 Classic"
   "VH1 Classic Europe" "VH1 Classic"
   "VH1 Europe" "VH1 europe"
   "VH1 UK" "VH1 UK"
   "Viva" "Viva"
   "Voice TV" "Voice TV"
   "Voice Tv" "Voice TV"
   "The Voice" "Voice TV"
   "The Voice TV" "Voice TV"
   "Eurosport" "Eurosport"
   "Eurosport 2" "Eurosport 2"
   "Eurosport 2 HD" "Eurosport 2"
   "Eurosport 2 (HD)" "Eurosport 2"
   "Eurosport HD" "Eurosport HD"
   "Eurosport (HD)" "Eurosport HD"
   "TV1000" "TV1000"
   "TV1000 Action" "TV1000 Action"
   "TV1000 Classic" "TV1000 Classic"
   "TV1000 Drama" "TV1000 Drama"
   "TV1000 Family" "TV1000 Family"
   "TV1000 HD" "TV1000 HD"
   "TV1000 Nordic" "TV1000 Nordic"
   "Viasat Explorer" "Viasat Explorer"
   "Viasat Golf" "Viasat Golf"
   "Viasat History" "Viasat History"
   "HISTORY" "Viasat History"
   "Viasat Nature/Action" "Viasat Nature/Action"
   "Canal+ Action" "Canal+ Action"
   "Canal+ Comedy" "Canal+ Comedy"
   "Canal+ Drama" "Canal+ Drama"
   "Canal+ First" "Canal+ First"
   "Canal+ HD" "Canal+ HD"
   "Canal+ Hits" "Canal+ Hits"
   "Canal+ Sport Extra" "Canal+ Sport Extra"
   "Canal+ Sport1" "Canal+ Sport1"
   "Canal+ Sport2" "Canal+ Sport2"
   "BBC Entertainment" "BBC Entertainment"
   "BBC HD" "BBC HD"
   "BBC Knowledge" "BBC Knowledge"
   "BBC Lifestyle" "BBC Lifestyle"
   "BBC World" "BBC World"
   "BBC World News" "BBC World"
   "CNN" "CNN"
   "Sky News" "Sky News"
   "Disney Channel" "Disney Channel"
   "Disney XD" "Disney XD"
   "Nickelodeon" "Nickelodeon"
   "Nickelodeon HD" "Nickelodeon"
   "Nickelodeon (HD)" "Nickelodeon"
   "Playhouse Disney" "Playhouse Disney"
   "Disney Junior" "Playhouse Disney"
   "Cartoon" "Cartoon"
   "Cartoon Network" "Cartoon"
   "3-SAT" "3-SAT Tyskland"
   "ARD" "ARD Tyskland"
   "ARD (HD)" "ARD Tyskland"
   "Das Erste HD" "ARD Tyskland"
   "ARTE" "ARTE Tyskland"
   "Arte HD" "ARTE Tyskland"
   "DSF" "DSF Tyskland"
   "NDR" "NDR Tyskland"
   "N3 (NDR)" "NDR Tyskland"
   "Pro7" "Pro7 Tyskland"
   "PRO7" "Pro7 Tyskland"
   "Pro 7" "Pro7 Tyskland"
   "PRO 7" "Pro7 Tyskland"
   "RTL" "RTL Tyskland"
   "RTL2" "RTL2 Tyskland"
   "SAT1" "SAT1 Tyskland"
   "Super RTL" "Super RTL Tyskland"
   "VOX" "VOX Tyskland"
   "ZDF" "ZDF Tyskland"
   "ZDF HD" "ZDF Tyskland"
   "ZDF (HD)" "ZDF Tyskland"
   "TV5 MONDE" "TV5 MONDE"
   "TV2 Norge" "Norsk TV2"
   "TV2 Norge HD" "Norsk TV2"
   "TV 2 Norge HD" "Norsk TV2"
   "NRK1" "NRK1 Norge"
   "NRK 1" "NRK1 Norge"
   "NRK 1 HD" "NRK1 Norge"
   "NRK2" "NRK2 Norge"
   "TV 2 Filmkanalen Norge" "TV 2 Filmkanalen Norge"
   "TV 2 Sport Norge" "TV 2 Sport Norge"
   "TV 2 Zebra Norge" "TV 2 Zebra Norge"
   "TV3 Norge" "TV3 Norge"
   "Rush HD" "Rush HD"
   "TV1 Sverige" "TV1 Sverige"
   "SVT1" "TV1 Sverige"
   "SVT1 HD" "TV1 Sverige"
   "SVT1 (HD)" "TV1 Sverige"
   "SVT2" "TV2 Sverige"
   "SVT2 HD" "TV2 Sverige"
   "SVT2 (HD)" "TV2 Sverige"
   "TV2 Sverige" "TV2 Sverige"
   "TV3 Sverige" "TV3 Sverige"
   "TV4 fakta Sverige" "TV4 fakta Sverige"
   "TV4 film Sverige" "TV4 film Sverige"
   "TV4 guld Sverige" "TV4 guld Sverige"
   "TV4 komedie Sverige" "TV4 komedie Sverige"
   "TV4 Science Fiction Sverige" "TV4 Science Fiction Sverige"
   "TV4 sport Sverige" "TV4 sport Sverige"
   "TV4" "TV4 Sverige"
   "TV4 Sverige" "TV4 Sverige"
   "TV4+ Sverige" "TV4+ Sverige"
   "TV400 Sverige" "TV400 Sverige"
   "SF-Kanalen" "SF-Kanalen"
   "Showtime" "Showtime"
   "Silver" "Silver"
   "Silver HD" "Silver HD"
   "Star!" "Star!"
   "TCM" "TCM"
   "Body in Balance" "Body in Balance"
   "Boomerang" "Boomerang"})

(def APInames->APIids
  "A relation mapping channel names from the API to their ids."
  {"DR1" "dr1"
   "DR2" "dr2"
   "DR HD" "tvh"
   "DR K" "tvk"
   "DR Ramasjang" "tvr"
   "DR Update" "dru"
   "TV 2" "td2"
   "TV 2 zulu" "t2z"
   "TV 2 charlie" "041"
   "TV 2 film" "t2f"
   "TV 2 NEWS" "tws"
   "TV 2 Sport" "t2s"
   "TV 2 Sport HD" "092"
   "TV 3" "dk3"
   "TV3+" "d3plus"
   "TV 3 Puls" "tpl"
   "Kanal 4" "tvd"
   "Kanal 5" "999"
   "6´eren" "snt"
   "Canal9" "ca9"
   "DK4" "dk4"
   "Kanal København" "lkk"
   "Discovery Channel" "dsc"
   "Discovery Civilisation" "dic"
   "Discovery HD" "057"
   "Discovery Science" "dis"
   "Discovery Travel & Living" "dit"
   "Animal HD" "047"
   "Animal Planet" "ans"
   "National Geographics" "ngs"
   "National Geographic HD" "076"
   "National Geographic Wild" "077"
   "History Channel" "064"
   "MTV" "mtv"
   "MTV Dance" "069"
   "MTV HD" "070"
   "MTV Hits" "071"
   "MTV R" "074"
   "MTV TWO" "075"
   "VH1" "vh1"
   "VH1 Classic" "104"
   "VH1 europe" "105"
   "VH1 UK" "106"
   "Viva" "090"
   "Voice TV" "042"
   "Eurosport" "ess"
   "Eurosport 2" "062"
   "Eurosport HD" "063"
   "TV1000" "t0d"
   "TV1000 Action" "1ac"
   "TV1000 Classic" "t1d"
   "TV1000 Drama" "tdm"
   "TV1000 Family" "1fa"
   "TV1000 HD" "095"
   "TV1000 Nordic" "1no"
   "Viasat Explorer" "vse"
   "Viasat Golf" "goo"
   "Viasat History" "vhi"
   "Viasat Nature/Action" "t6a"
   "Canal+ Action" "cbd"
   "Canal+ Comedy" "cmf"
   "Canal+ Drama" "cpd"
   "Canal+ First" "cdk"
   "Canal+ HD" "chd"
   "Canal+ Hits" "cgd"
   "Canal+ Sport Extra" "cpx"
   "Canal+ Sport1" "cps"
   "Canal+ Sport2" "cs7"
   "BBC Entertainment" "bbp"
   "BBC HD" "048"
   "BBC Knowledge" "049"
   "BBC Lifestyle" "050"
   "BBC World" "bbw"
   "CNN" "cnn"
   "Sky News" "skn"
   "Disney Channel" "218"
   "Disney XD" "058"
   "Nickelodeon" "nis"
   "Playhouse Disney" "plh"
   "Cartoon" "cns"
   "3-SAT Tyskland" "3st"
   "ARD Tyskland" "ard"
   "ARTE Tyskland" "arg"
   "DSF Tyskland" "dsf"
   "NDR Tyskland" "tn3"
   "Pro7 Tyskland" "pr7"
   "RTL Tyskland" "rtp"
   "RTL2 Tyskland" "rt2"
   "SAT1 Tyskland" "st1"
   "Super RTL Tyskland" "sup"
   "VOX Tyskland" "vox"
   "ZDF Tyskland" "zdf"
   "TV5 MONDE" "ft5"
   "Norsk TV2" "no1"
   "NRK1 Norge" "nk1"
   "NRK2 Norge" "nk2"
   "TV 2 Filmkanalen Norge" "091"
   "TV 2 Sport Norge" "093"
   "TV 2 Zebra Norge" "094"
   "TV3 Norge" "no3"
   "Rush HD" "084"
   "TV1 Sverige" "sv1"
   "TV2 Sverige" "sv2"
   "TV3 Sverige" "tv3"
   "TV4 fakta Sverige" "096"
   "TV4 film Sverige" "097"
   "TV4 guld Sverige" "098"
   "TV4 komedie Sverige" "099"
   "TV4 Science Fiction Sverige" "100"
   "TV4 sport Sverige" "101"
   "TV4 Sverige" "tv4"
   "TV4+ Sverige" "102"
   "TV400 Sverige" "103"
   "SF-Kanalen" "085"
   "Showtime" "086"
   "Silver" "087"
   "Silver HD" "088"
   "Star!" "089"
   "TCM" "tns"
   "Body in Balance" "052"
   "Boomerang" "053"})